<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" href="../../favicon.ico">
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection"/>
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="font-awesome-4.6.3/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//rawgithub.com/Caged/d3-tip/master/examples/example-styles.css">
    <link rel="stylesheet" href="css/main.css">

    <title>Graf wspolpracy</title>
</head>

<body>

<script src="https://d3js.org/d3-path.v1.min.js"></script>
<script src="js/jquery-3.1.0.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="js/remove-diacritics.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="js/d3-tip.js"></script>
<script src="js/parse-raw-expertus.js"></script>
<script src="js/collab-demo-1.js"></script>
<script src="js/bar-graph.js"></script>
<script src="js/works-over-time-demo-1.js"></script>
<script src="js/expertus-retriever.js"></script>
<script src="js/collab.js"></script>

<nav>
    <div class="nav-wrapper">
        <a href="#" class="brand-logo">Wizualizator naukowca</a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a href="index.html">Wizualizacje</a></li>
        </ul>
    </div>
</nav>
<div class="row">
    <div class="col s4" style="padding-left: 0">
        <div class="z-depth-1 vis-info">
            <div class="row">
                <div class="card">
                    <div class="card-content white-text">
                        <span class="card-title">Chmura słów</span>
                        <p>Zbiór słów najczęściej występujących w tytułach prac naukowych.</p>
                    </div>
                </div>
            </div>

            <div class="row">
                <!--<ul class="collection with-header z-depth-1">-->
                    <!--<li class="collection-header"><h5>Szczegóły</h5></li>-->
                    <!--<li class="collection-item">-->
                        <!--<div><span>Łącznie prac: </span> <span id="works-amount-display" style="float: right">-</span>-->
                        <!--</div>-->
                    <!--</li>-->
                    <!--<li class="collection-item">-->
                        <!--<div><span>Publikacji w czasopismach: </span> <span id="publications-amount-display"-->
                                                                            <!--style="float: right">-</span></div>-->
                    <!--</li>-->
                    <!--<li class="collection-item">-->
                        <!--<div><span>Średnia prac w czasie: </span> <span id="mean-works-amount-display"-->
                                                                        <!--style="float: right">-</span></div>-->
                    <!--</li>-->
                <!--</ul>-->
            </div>
        </div>

    </div>
    <div class="col s8">
        <svg class="z-depth-1 svg-port" id="svg-port"></svg>
    </div>
</div>

<script>
    $(document).ready(function () {
        console.log('Querying against name: ' + document.cookie.split('name=')[1].split(';')[0]);
        var svg = d3.select('#svg-port');

        var width = parseInt(svg.style('width').replace('px', '')) - 100;
        var height = parseInt(svg.style('height').replace('px', '')) - 100;
        $.post("wordcloudData", {name: document.cookie.split('name=')[1].split(';')[0], width: width, height: height}, function (data) {

//                    console.log(titleWordsArray);
                    displayWordcloud(data);
//                    displayWorkStatsWorksInTime(barData);
                }
        )
    });




    function displayWordcloud(textObjects) {
        var svg = d3.select('#svg-port');

        var width = parseInt(svg.style('width').replace('px', '')) - 20;
        var height = parseInt(svg.style('height').replace('px', '')) - 20;

        var colorScale = d3.scaleOrdinal(d3.schemeSet3)
            .domain([0, 10]);

        svg
            .append('g')
            .attr('transform', (d) => {return 'translate( ' + [width/2, height/2] + ')'})
            .selectAll('text')
            .data(textObjects)
            .enter()
            .append('text')
            .text((d) => {return d.text})
            .attr('fill', (d, i) => {return colorScale(i%10)})
            .attr('width', (d)=>{return d.width})
            .attr('height', (d)=>{return d.height})
            .attr('font-size', (d) => {return d.size + 'px'})
            .attr('font-family', 'serif')
            .attr('x', (d) => {return d.x})
            .attr('y', (d) => {return d.y});
//            .attr('transform', (d) => {
//                return 'translate( ' + [d.x, d.y] + ')';
//        })

    }

    /**
     *
     * @param rawData {Array} - DB records cotaining field title with the full title of the work
     * @returns {Array} - An array of all words in the titles of all works
     */
    function getWordsArray(rawData) {

        let wordArray = [];

        rawData.map( (record) => {
            return record.title;
        }).forEach( (title, index) => {

            if(title) wordArray = wordArray.concat(title.split(' '))
            else console.log('Undefined title at ' + index)
        });

        return wordArray;
    }
</script>


</body>
</html>

</body>
</html>