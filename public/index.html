<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" href="../../favicon.ico">
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="font-awesome-4.6.3/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//rawgithub.com/Caged/d3-tip/master/examples/example-styles.css">
    <link rel="stylesheet" href="css/main.css">


    <title>Strona główna</title>
</head>

<body>

<script src="js/jquery-3.1.0.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="js/remove-diacritics.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="js/collaboration-graph.js"></script>
<script src="js/d3-tip.js"></script>
<script src="js/parse-raw-expertus.js"></script>
<script src="js/collab-demo-1.js"></script>
<script src="js/bar-graph.js"></script>
<script src="js/works-over-time-demo-1.js"></script>
<script src="js/expertus-retriever.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>


<nav>
    <div class="nav-wrapper">
        <a href="#" class="brand-logo">Wizualizator naukowca</a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a href="index.html">Wizualizacje</a></li>
        </ul>
    </div>
</nav>

<script>
    $(document).ready(function () {

        var selectForm = $('#name-select-form');
        selectForm.submit(function (event) {
            event.preventDefault();
            var trueName = $('label[for="' + $('input[type="radio"]:checked').attr("id") + '"]').text();
            $('.vis-form-name-input').val(trueName);
        })
    });
    var inputFocused = false;
    var wasChangedControlValue = 0;

    function SetInputFocused() {inputFocused = true;}
    function SetInputBlurred() {inputFocused = false;}

    function InputChanged() {
        wasChangedControlValue++;
        var thisId = wasChangedControlValue;
        setTimeout(function () {
            if(wasChangedControlValue == thisId) {
                QueryForSuggestions()
                wasChangedControlValue = 0;
            }
        }, 1500)
    }
    function QueryForSuggestions() {
        var autocompletedInput = $('#name-and-surname-autocomplete');
        var queryName = autocompletedInput.val();
        console.log(queryName);

        $.ajax('/name-lookup', {
            data: {
                name: queryName
            }
        }).done(function (queryResults) {
            console.log(queryResults);
            
            function getLi(content) {
                return '<li onclick="SetChosenResult(this)" class="dropdown-namelist-item"><span>' + content + ' </span> </li >'
            }
            
            var $results = $('#results');
            queryResults.forEach(function (result) {
                $results.append(getLi(result))
            })

        });
//        var queryResults = {};
//        queryResults[queryName] = null;
//        queryResults[queryName + '1'] = null;
//        queryResults[queryName + '2'] = null;
//        $('input.autocomplete').autocomplete({
//            queryResults,
//            limit: 20 // The max amount of results that can be shown at once. Default: Infinity.
//        });
    }

    function SetChosenResult(chosenListElement) {
        console.log('Selected ' + chosenListElement.textContent);

        var resultArray = chosenListElement.textContent.trim().split(' ');
        resultArray = resultArray.map(function (allCapsWord) {
            var initial = allCapsWord.charAt(0);
            return initial + allCapsWord.slice(1).toLocaleLowerCase()
        });
        $('#name-and-surname-autocomplete').val(chosenListElement.textContent);
        $('#results').empty();
        EnableVisualisationRedirectButtons();
        document.cookie = 'name=' + resultArray[resultArray.length - 1] + ' ' + resultArray[0] + '; ';
        console.log(document.cookie)
    }

//    $(document).ready(
//            $('#name-input-form').submit(function (event) {
//
//                event.preventDefault();
//                /* var name = null, surname = null;
//                 $('#name-input-form').find('input[type=text]').each(function () {
//                 if($(this).name == 'name') name = $(this).name;
//                 else surname = $(this).name;
//                 });*/
//                var formData = {};
//                $('#name-input-form').serializeArray().forEach(function (el) {
//                    if(el.name == 'name') formData.name = el.value;
//                    if(el.name == 'surname') formData.surname = el.value;
//                });
//                document.cookie = 'name=' + formData.name + ' ' + formData.surname + ';';
//                EnableVisualisationRedirectButtons();
//                formData.mode = 'names';
//                formData.name = formData.surname + ' ' + formData.name;
//                console.log('Fetching with formData: ');
//                console.log(formData);
//                $.post("retrieve", formData, function( data ) {
//                    console.log(data);
//                    data = JSON.parse(data);
//                    // var selectForm = $('#name-select-form');
//                    var listHeader = $('#name-select-list-header');
//                    data = data.slice(0, 5).reverse();
//                    data.forEach(function (name, index) {
//                        name = name.split(' ')[1] + ' ' + name.split(' ')[0];
//                        var listElement =
//                                $(  '<li class="collection-item">' +
//                                        '<input name="true_name" type="radio" id="' + index + '">' +
//                                        '<label for="' + index + '">' + name + '</label></li>' );
//                        listHeader.after(listElement);
//                    });
//                    $('#name-select-card').attr("hidden", false)
//
//                });
//            })
//    );

    $(document).click(function () {
        if (!$(event.target).closest('#results').length) {
            $('#results').empty();
        }
    });

    function EnableVisualisationRedirectButtons() {
        $('.vis-redirect').prop('disabled', false)
    }
</script>

<div class="row">
    <div class="col s4">
    <div class="z-depth-1 vis-select ">
    <div class="row" hidden="hidden">
        <div class="card file-input-card">
            <div class="card-content black-text file-input-container">
                <span class="card-title"> Dane wejściowe</span>
                <p>prześlij plik z bazy ekspertus, na podstawie ktorego strona wygeneruje wizualizacje</p>
                <form action="#" id="file-input-form">
                    <div class="file-field input-field">
                        <div class="btn">
                            <span>Plik</span>
                            <input type="file" id="file-input">
                        </div>
                        <div class="file-path-wrapper">
                            <input class="file-path validate" type="text">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="card name-input-card col s12">
            <div class="card-content black-text">
                <span class="card-title">Imię i nazwisko</span>
                <p>Podaj swoje imię i nazwisko, a aplikacja przeszuka bazę Ekspertus za Ciebie</p>
                    <div>
                        <div class="row">
                            <div class="input-field col s12">
                                <input placeholder="Nazwisko i imię" type="text" id="name-and-surname-autocomplete"
                                       class=" autocomplete name-input-bar" name="name" title="name"
                                       oninput="InputChanged()" onfocus="SetInputFocused()" onblur="SetInputBlurred()">
                            </div>
                            <ul id="results" class="dropdown-content" style="opacity:100; display: block"></ul>
                        </div>
                    </div>

            </div>

        </div>
    </div>
    <div class="row" hidden="hidden">
        <div class="card name-select-card" id="name-select-card" hidden="hidden">
            <form action="#" id="name-select-form">
                <ul class="collection with-header" id="name-select-list">
                    <li class="collapsible-header" id="name-select-list-header" style="font-size: xx-large">
                        Zaznacz na liscie swoje imie
                    </li>

                </ul>
                <button class="btn waves-effect" type="submit" id="name-select-submit">
                    Wybierz
                </button>
            </form>
        </div>

    </div>
    <div class ="row" hidden="hidden">
        <div class="card">
            <div class="card-content white-text">
                <span class="card-title">Graf współautorstwa</span>
                <p>Symulacja, w której każda osoba oznaczona we wczytanej pracy jako współautor jest przedstawiona jako węzeł, który przyciągany jest do innych tym silniej, im więcej dzieli z nimi prac naukowych</p>
            </div>
            <div class="card-action">
                <a class="btn waves-effect waves-light disabled vis-select-btn" onclick="drawSimulationCollaborationGraph(parsedData.collaboration)" href="#">Wyświetl</a>
                <a class="btn waves-effect waves-light demo" onclick="toggleCollabDemo()" href="#">Demo</a>
            </div>
        </div>
    </div>
    <div class ="row" hidden="hidden">
        <div class="card ">
            <div class="card-content white-text">
                <span class="card-title">Prace w czasie</span>
                <p>Zestawienie liczby publikacji na osi Oy wraz z rokiem publikacji na osi Ox, z wyszczególnieniem artykułów oraz książek.</p>
            </div>
            <div class="card-action">
                <a class="btn waves-effect waves-light disabled vis-select-btn" onclick="drawWorksOverTimeGraph(parsedData.worksOverTime)" href="#">Wyświetl</a>
                <a class="btn waves-effect waves-light demo" onclick="drawWorksOverTimeGraph(WorksDemo())" href="#">Demo</a>
            </div>
        </div>
    </div>
</div>
    </div>
    <div class="col s8" style="margin-top: 20px; padding-right: 10em">
        <div class="select-cards-container" >
                <div class="col s6" id="row1">
                    <div class="card white-text" style="margin-bottom: 20px">
                        <div class="card-image">
                            <img src="images/works-thumb.png" height="250px">
                            <span class="card-title black-text">Prace w czasie</span>
                        </div>
                        <div style="padding: 10px; height: 100px" class="card-content">
                            <p>Zestawienie liczby publikacji na osi Oy wraz z rokiem publikacji na osi Ox, z wyszczególnieniem artykułów oraz książek.</p>
                        </div>
                        <div class="card-action">
                            <form action="works.html" method="get" enctype="application/x-www-form-urlencoded">
                                <input type="submit" class="btn waves-effect waves-light vis-redirect" >
                            </form>
                        </div>
                    </div>
                    <div class="card white-text">
                        <div class="card-image">
                            <img src="images/research-map-thumb.jpg" height="250px">
                            <span class="card-title black-text">Kolo dziedzin</span>
                        </div>
                        <div style="padding: 10px; height: 100px" class="card-content">
                            <p>Krotki opis kola dziedzin</p>
                        </div>
                        <div class="card-action">
                            <form action="research-map.html" method="get" enctype="application/x-www-form-urlencoded">
                                <input type="submit" class="btn waves-effect waves-light vis-redirect">
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col s6" id="row2">
                    <div class="card white-text" style="margin-bottom: 20px">
                        <div class="card-image">
                            <img src="images/collab-thumb.png" height="250px">
                            <span class="card-title black-text">Graf współpracy</span>
                        </div>
                        <div style="padding: 10px; height: 100px" class="card-content">
                            <p>Symulacja, w której każda osoba oznaczona we wczytanej pracy jako współautor jest przedstawiona jako węzeł, który przyciągany jest do innych tym silniej, im więcej dzieli z nimi prac naukowych</p>
                        </div>
                        <div class="card-action">
                            <form action="collab.html" method="get" enctype="application/x-www-form-urlencoded">
                                <input type="submit" class="btn waves-effect waves-light vis-redirect" >
                            </form>
                        </div>
                    </div>
                    <div class="card white-text">
                        <div class="card-image">
                            <img src="images/bubbles-thumb.png" height="250px">
                            <span class="card-title black-text">Graf bąbelkowy</span>
                        </div>
                        <div style="padding: 10px; height: 100px" class="card-content">
                            <p>Krótki opis grafu bąbelkowego</p>
                        </div>
                        <div class="card-action">
                            <form action="bubbles.html" method="get" enctype="application/x-www-form-urlencoded">
                                <input type="submit" class="btn waves-effect waves-light vis-redirect" >
                            </form>
                        </div>
                    </div>
                </div>
        </div>
    </div>
</div>


</body>
</html>